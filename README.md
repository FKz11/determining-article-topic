## Годовой проект на тему:<br>"Определение тематики статьи на habr.ru"
### Авторы: 
[Рубин Даниил Олегович](https://github.com/rubin-do), <br> [Сергеев Константин Олегович](https://github.com/FKz11), <br> [Кондрашов Константин Юрьевич](https://github.com/Steelrat1997)
### Куратор: 
Вольф Елена

### Задача

Статьи на habr.ru содержат:
 - заголовок
 - текст
 - картинки
 - теги
 - **хабы**
 - комментарии

Примеры хабов:
1. IT-компании
2. Физика
3. Ноутбуки
4. Веб-дизайн

Наша задача заключается в реализации нейронной сети, которая будет автоматически предлагать хабы на основе написанной автором статьи.
Автоматическое проставление хабов позволит:
 - Улучшить опыт пользователей
 - Экономить время авторов

### Инструкция по запуску

Необходимо создать в корне репозитория файл .env с ключами от s3 в таком формате:
```
S3_ACCESS_KEY=...
S3_SECRET_KEY=...
```

После этого можно собрать докер-контейнеры:
```
docker compose build
```

И запустить:
```
docker-compose up
```

В результате, будет запущено три контейнера:
- Сервис с FastAPI
- Redis-кэш
- Бэкенд тг-бота

### Сервис на FastAPI
[Образ на dockerhub](https://hub.docker.com/r/axer1/habr-service)
#### Post: /predict

Этот эндпоинт принимает POST запрос с телом запроса в формате PredictRequest. Он использует построенную модель для предсказания хабов статьи.

##### Тело запроса (PredictRequest):
```json
{
  "text": "<Текст статьи>",
  "num_hubs": "<Количество хабов в предсказании>"
}
```

##### Ответ (PredictResponse):
```json
{
  "hubs": ["<список предсказанных хабов>"]
}
```
Если ответ доступен в кэше, возвращается результат из кэша. В противном случае генерируется предсказание, и результат сохраняется в кэше на 1 час.

#### Post: /predict_file

Аналогично эндпоинту /predict, этот эндпоинт выполняет предсказания на основе содержимого загруженного файла. Принимает формат multipart/form-data с загружаемым файлом и количеством возвращаемых предсказаний.

##### Данные формы запроса:
- file: Файл с текстом для предсказания.
- num_hubs: Количество хабов в предсказании.

##### Ответ (PredictResponse):
```json
{
  "hubs": ["<список предсказанных хабов>"]
}
```
Система кэширования также действует для предсказаний на основе загружаемых файлов.

#### Post: /feedback

Этот эндпоинт используется для получения обратной связи от пользователей тг-бота.

##### Тело запроса:
```json
{
  "button": "Значение удовлетворенности (значение кнопки обратной связи)"
}
```

#### Get: /ping

Этот эндпоинт служит для проверки готовности сервиса к работе.

#### Ответ (PingResponse):
```json
{
  "message": "Сервис готов к работе!",
  "active": true
}
```

### Redis
Redis служит кэшом для сервиса, выполняющего предсказания. После предсказания результат сохраняется в кэше с временем жизни 1 час. При запросах за предсказаниями сервис проверяет есть ли результат в кэше, и если есть он сразу отдается.

### Бэкенд тг-бота

[Образ на dockerhub](https://hub.docker.com/r/axer1/tg-bot)

При запуске загрузит из s3 токен для telegram api, после этого запустится и будет обрабатывать сообщения от пользователей. Поддерживает следующие команды:
- /start (начало работы, приветствие)
- /help (помощь)
- /change_num_hubs (изменить количество предсказываемых хабов)
- отправка текста статьи (предсказывает хабы для отправленной статьи)
- отправка файла статьи (предсказывает хабы для отправленной статьи)
- /rating (отправка оценки удовлетворенности взаимодействием с ботом)


![demonstration](https://github.com/rubin-do/determining-article-topic/assets/25878599/50b33ea3-730a-42ba-9d64-23ef31cffd3d)
