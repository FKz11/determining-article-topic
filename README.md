## Годовой проект на тему:<br>"Определение тематики статьи на habr.ru"
### Авторы: 
Рубин Даниил Олегович, <br> Сергеев Константин Олегович, <br> Кондрашов Константин Юрьевич
### Куратор: 
Вольф Елена

### Инструкция по запуску

Необходимо создать в корне репозитория файл .env с ключами от s3 в таком формате:
```
S3_ACCESS_KEY=...
S3_SECRET_KEY=...
```

После этого можно собрать докер-контейнеры:
```
docker compose build
```

И запустить:
```
docker-compose up
```

В результате, будет запущено три контейнера:
- Сервис с FastAPI
- Redis-кэш
- Бэкенд тг-бота

### Сервис на FastAPI
#### Post: /predict

Этот эндпоинт принимает POST запрос с телом запроса в формате PredictRequest. Он использует построенную модель для предсказания хабов статьи.

##### Тело запроса (PredictRequest):
```json
{
  "text": "<Текст статьи>",
  "num_hubs": "<Количество хабов в предсказании>"
}
```

##### Ответ (PredictResponse):
```json
{
  "hubs": ["<список предсказанных хабов>"]
}
```
Если ответ доступен в кэше, возвращается результат из кэша. В противном случае генерируется предсказание, и результат сохраняется в кэше на 1 час.

#### Post: /predict_file

Аналогично эндпоинту /predict, этот эндпоинт выполняет предсказания на основе содержимого загруженного файла. Принимает формат multipart/form-data с загружаемым файлом и количеством возвращаемых предсказаний.

##### Данные формы запроса:
- file: Файл с текстом для предсказания.
- num_hubs: Количество хабов в предсказании.

##### Ответ (PredictResponse):
```json
{
  "hubs": ["<список предсказанных хабов>"]
}
```
Система кэширования также действует для предсказаний на основе загружаемых файлов.

#### Post: /feedback

Этот эндпоинт используется для получения обратной связи от пользователей тг-бота.

##### Тело запроса:
```json
{
  "button": "Значение удовлетворенности (значение кнопки обратной связи)"
}
```

#### Get: /ping

Этот эндпоинт служит для проверки готовности сервиса к работе.

#### Ответ (PingResponse):
```json
{
  "message": "Сервис готов к работе!",
  "active": true
}
```

### Redis
Redis служит кэшом для сервиса, выполняющего предсказания. После предсказания результат сохраняется в кэше с временем жизни 1 час. При запросах за предсказаниями сервис проверяет есть ли результат в кэше, и если есть он сразу отдается.

### Бэкенд тг-бота

![demonstration](https://github.com/rubin-do/determining-article-topic/assets/25878599/50b33ea3-730a-42ba-9d64-23ef31cffd3d)
